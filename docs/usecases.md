# Use Cases Definition

## 1. Actors
### Infrastructure Manager (インフラ管理者)
チームまたは組織のクラウドインフラのコスト管理責任者。
**週に1回程度**、コスト状況をチェックし、予算超過の兆候がないか確認する。
また、月末や四半期末には、経理部門が管理する「全体コスト管理スプレッドシート」への計上のため、予算計画や実績値を報告する義務を持つ。

## 2. Global Preconditions
- **認証情報**:
    - ローカル環境 (`~/.aws/credentials` 等) のプロファイル、**または環境変数** (`AWS_ACCESS_KEY_ID` 等) により、AWS Cost Explorer APIへのアクセスが可能であること。
    - **STS (Session Token)** を含めた一時的な認証情報もサポートする。

## 3. Use Cases

### UC-01: 月次予算状況の監視 (Monitor Monthly Budget Status)
**Goal**: 今月の請求額が予算を超過しないかを確認し、安心を得る（または対策を打つ）。
- **Main Success Scenario**:
  1. [User] アプリを起動し、ダッシュボードを表示する。
  2. [System] 最終同期日時をチェックし、前回から一定期間（例: 7日）以内であれば、保存されたコストデータを表示する。
      - **Note**: 表示コストは **Amortized Cost (償却原価)** かつ **税抜 (Tax Excluded)**。
      - **Note**: USD（メイン）と JPY（参考）を併記する。
  3. [User] 「現在の実績コスト」と「月末の着地見込」を、設定された「月次予算」と比較する。
  4. [System] 予算超過が予測される場合、アラート（赤字やアイコン）を表示する。
- **Alternative Flows**:
  - **2a. データの陳腐化**: 最終同期から一定期間以上経過している場合。
      1. [System] 画面上部に「データが古くなっています」という警告を表示する。
      2. [User] 必要に応じて UC-04 (データ同期) を実行する。
- **Postconditions**:
  - ユーザーは現在のコスト状況と予算対比を把握している状態になる。

### UC-02: コスト変動要因の特定 (Identify Cost Drivers)
**Goal**: 前月と比較してコストが増加しているサービスを特定し、その原因（利用タイプ）を突き止める。
- **Main Success Scenario**:
  1. [User] 詳細分析画面（Analytics）へ移動する。
  2. [System] サービスごとのコストを降順でリスト表示する。
      - **Note**: 各行には「前月同期間のコスト」との差額・増減率 (MoM) が表示される。
  3. [User] 前月比で急増しているサービス（赤字ハイライト等）を特定し、クリックする。
  4. [System] 選択されたサービスの **Usage Type (利用タイプ)** 別内訳を表示する。
  5. [User] 具体的な増加要因（例: DataTransfer-Out-Bytes）を特定する。
  6. [User] (Optional) 「コピー」ボタンをクリックする。
  7. [System] 表示中の内訳データを TSV 形式でクリップボードにコピーする。
- **Postconditions**:
  - クリップボードに分析データが格納される（Optional）。

### UC-03: 中長期予算計画の策定 (Plan Future Budget)
**Goal**: 翌月、四半期、来年度の予算計画を立て、**経理報告用の数字**を算出する。
- **Main Success Scenario**:
  1. [User] 予測シミュレーション画面（Forecast）へ移動する。
  2. [User] ターゲットとなる期間（翌月、向こう3ヶ月、来年度など）を選択する。
  3. [System] 直近の傾向（償却コストベース）から、指定期間の予測コストを算出・表示する。
  4. [User] 必要に応じて「変動係数」や「追加固定費」を調整し、シミュレーションを行う。
  5. [User] 算出結果に納得したら、「コピー」ボタンをクリックする。
  6. [System] シミュレーション結果（期間合計、月別内訳）を TSV 形式でクリップボードにコピーする。
- **Postconditions**:
  - 経理報告用の予測値がクリップボードに格納される。

### UC-04: データ同期と外部連携 (Sync & Share)
**Goal**: 最新のデータで分析を行い、結果を外部連携する。
- **Main Success Scenario**:
  1. [User] 「AWS同期」ボタンをクリックする。
  2. [System] 設定されたプロファイル（または環境変数）を用いて AWS Cost Explorer API を実行する。
  3. [System] 取得したデータ（Amortized Cost）をローカルDBに保存し、最終同期日時を更新する。
  4. [System] 画面をリフレッシュし、最新データを表示する。
- **Alternative Flows**:
  - **2a. 認証エラー**: クレデンシャルが無効または期限切れ（STS含む）の場合。
      1. [System] エラーメッセージ（例: ExpiredToken）を表示し、同期を中断する。
      2. [User] 外部ツール（AWS CLI等）で認証情報を更新し、再度同期を実施する。
- **Postconditions**:
  - ローカルDBが最新のAWSデータと同期されている。

### UC-05: 予算管理 (Manage Budget)
**Goal**: プロジェクトや組織の予算金額を設定または更新する。
- **Main Success Scenario**:
  1. [User] 設定画面（Settings）へ移動する。
  2. [User] 対象のアカウント（または全体）の「月次予算 (USD)」を入力する。
  3. [User] 必要に応じて「参考為替レート (JPY/USD)」を入力する。
  4. [System] 入力値を保存する。
  5. [User] ダッシュボードに戻る。
  6. [System] 新しい予算とレートに基づいて、進捗バーとJPY換算額を再描画する。
- **Postconditions**:
  - アプリケーション内の予算設定と為替レートが更新される。
